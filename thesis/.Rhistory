library(tidyverse)
library(data.table)
library(patchwork)
getwd()
master19 <- read.table(gzfile("data/DRV_Master/2019_Options_Master.csv.gz")) %>%
tibble()
master19
master19 <- read_csv(gzfile("data/DRV_Master/2019_Options_Master.csv.gz")) %>%
tibble()
master19
master19 <- read_csv(gzfile("data/DRV_Master/2019_Futures_Master.csv.gz")) %>%
tibble()
master19
master <- tibble()
for(i in 2010:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble()
master <- master %>% bind_rows(tmp)
}
rm(list = ls())
source("1.setting.R")
master <- tibble()
master <- tibble()
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble()
master <- master %>% bind_rows(tmp)
}
tmp
View(tmp)
master <- tibble()
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"), EXPMM_NO<=2) %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
View(master)
master <- tibble()
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"),
EXPMM_NO<=2, substr(ISU_CD,4,1)==1) %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"),
EXPMM_NO<=2, substr(ISU_CD,4,1)=="1") %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
substr(123456,4,1)
substr(123456,4,4)
master <- tibble()
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"),
EXPMM_NO<=2, substr(ISU_CD,4,4)==1) %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
View(master)
master <- master %>% arrange(TRD_DD,PROD_ID,EXPMM_NO)
master
master <- master %>% arrange(PROD_ID,EXPMM_NO,TRD_DD)
master
View(master)
master <- master %>% arrange(TRD_DD,PROD_ID,EXPMM_NO)
master
View(master)
master %>% group_by(TRD_DD,PROD_ID) %>% arrange(desc(ACC_TRDVOL)) %>% slice(!)
master %>% group_by(TRD_DD,PROD_ID) %>% arrange(desc(ACC_TRDVOL)) %>% slice(1)
lead <- master %>% group_by(TRD_DD,PROD_ID) %>% arrange(desc(ACC_TRDVOL)) %>% slice(1)
lead
View(lead)
K2I_lead <- master %>% filter(PROD_ID=="KRDRVFUK2I") %>% group_by(TRD_DD,PROD_ID) %>% arrange(desc(ACC_TRDVOL)) %>% slice(1)
View(K2I_lead)
View(master)
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1)
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% view()
View(master)
source("1.setting.R")
master <- tibble()
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"),
EXPMM_NO<=2, substr(ISU_CD,4,4)==1) %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
master <- master %>% arrange(TRD_DD,PROD_ID,EXPMM_NO)
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% view()
View(master)
View(master)
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% view()
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% select(TRD_DD)
master %>% filter(TRD_DD %in% (master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% select(TRD_DD)))
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% select(TRD_DD) %>%
left_join(master)
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% select(TRD_DD) %>%
left_join(master %>% filter(PROD_ID=="KRDRVFUK2I"))
master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys==1) %>% select(TRD_DD) %>%
left_join(master %>% filter(PROD_ID=="KRDRVFUK2I")) %>% view()
source("1.setting.R")
master <- tibble()
for(i in 2014:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"),
EXPMM_NO<=2, substr(ISU_CD,4,4)==1) %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
master <- master %>% arrange(TRD_DD,PROD_ID,EXPMM_NO)
master2 <- master %>% filter(TRD_DD>=20181101)
source("1.setting.R")
master <- tibble()
for(i in 2018:2023){
tmp <- read_csv(gzfile(paste0("data/DRV_Master/",i,"_Futures_Master.csv.gz"))) %>%
tibble() %>%
filter(PROD_ID %in% c("KRDRVFUK2I","KRDRVFUKQI"),
EXPMM_NO<=2, substr(ISU_CD,4,4)==1) %>%
select(TRD_DD,PROD_ID,ISU_CD,EXPMM,EXPMM_NO,remain_dys,TDD_CLSPRC,ACC_TRDVOL,ACC_TRDVAL)
master <- master %>% bind_rows(tmp)
}
master <- master %>% arrange(TRD_DD,PROD_ID,EXPMM_NO)
rollover_dd <- master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys<=4)
rollover_dd
rollover_dd <- master %>% filter(PROD_ID=="KRDRVFUK2I",remain_dys<=4) %>% select(TRD_DD)
rollover_dd
lead <- master %>% filter(EXPMM_NO==1)
rollover_dd
rollover <- rollover_dd %>% left_join(master %>% filter(EXPMM_NO==2))
rollover
View(rollover)
target_isu <- lead %>% bind_rows(rollover) %>% arrange(TRD_DD,PROD_ID,EXPMM_NO)
target_isu
View(target_isu)
target_isu
View(target_isu)
K2I_target <- target_isu %>% filter(PROD_ID=="KRDRVFUK2I")
K2I_target
K2I_target$TRD_DD[1]
K2I_target <- target_isu %>% filter(PROD_ID=="KRDRVFUK2I",TRD_DD>=20190101)
tmp <- read_csv(gzfile(paste0("data/DRV_TRD/",K2I_target$TRD_DD[1],"_DRV_TRD.csv.gz"))) %>%
tibble()
View(tmp)
tmp <- read_csv(gzfile(paste0("data/DRV_TRD/",K2I_target$TRD_DD[1],"_DRV_TRD.csv.gz"))) %>%
tibble() %>%
filter(ISU_CD==K2I_target$ISU_CD[1])
tmp
View(tmp)
View(tmp)
tmp <- read_csv(gzfile(paste0("data/DRV_TRD/",K2I_target$TRD_DD[1],"_DRV_TRD.csv.gz"))) %>%
tibble() %>%
filter(ISU_CD==K2I_target$ISU_CD[1],BRD_ID=="G1") %>%
select(TRD_DD,ISU_CD,SESS_ID,TRD_NO,TRD_TM,TRD_PRC,TRDVOL,ASK_STEP1_BSTORD_PRC,BID_STEP1_BSTORD_PRC,ASK_STEP1_BSTORD_RQTY,BID_STEP1_BSTORD_RQTY)
View(tmp)
tmp <- read_csv(gzfile(paste0("data/DRV_TRD/",K2I_target$TRD_DD[1],"_DRV_TRD.csv.gz"))) %>%
tibble() %>%
filter(ISU_CD==K2I_target$ISU_CD[1],BRD_ID=="G1") %>%
select(TRD_DD,ISU_CD,SESS_ID,TRD_NO,TRD_TM,TRD_PRC,TRDVOL,ASK_STEP1_BSTORD_PRC,BID_STEP1_BSTORD_PRC,ASK_STEP1_BSTORD_RQTY,BID_STEP1_BSTORD_RQTY) %>%
arrange(TRD_NO,TRD_TM)
View(tmp)
spec(tmp)
